#### 解决 AI 数理能力的难题

虽然 ChatGPT 回答各种问题的时候都像模像样的，但是一到计算三位数乘法的时候就露馅儿了。感觉它只是预估了一个数字，而不是真准确的计算。

虽然 ChatGPT 计算不行，但是可以用它写一段 python 的计算公式。然后再调用 python 的解释器。

LangChain 里面内置了一个 utilities 的包，里面包含了 PythonREPL 这个类，可以实现对 Python 解释器的调用。

utilities 里面还有很多其他的类，能够实现很多功能，比如可以直接运行 Bash 脚本，调用 Google Search 的 API 等等。

其实实现还是链式调用，只是调用链式的第二步，不是访问 OpenAI 的 API，而是生成 Python 脚本，再调用 python 的解释器的过程。LangChain 就把这个过程封装成了一个叫做 LLMMathChain 的 LLMChain。

SQLDatabaseChain、LLMRequestsChain

#### 通过 RequestsChain 获取实时外部信息

时效性比较强的问题，比如获取实时的天气情况。可以使用 LLMRequestsChain，通过一个请求来获取问题的答案。

使用到了好几个技巧：

1. 首先简单粗暴的搜索 Google，但我们需要的是天气信息而不是整个网页。所以需要 ChatGPT 找出答案。我们定义一个 PromptTemplate，通过一段提示语让 OpenAI 在搜索结果中找出答案，而不是原始 HTML 页面。
2. 然后使用 LLMRequestsChain，将 PromptTemplate 构造一个普通的 LLMChain，作为构造函数的一个参数，传给 LLMRequestsChain。
3. 对应的搜索词，通过 query 这个参数传入，对应的原始搜索结果，则会默认放到 requests_results 里。而通过我们自己定义的 PromptTemplate 抽取出来的最终答案，则会放到 output 这个输出参数里面。

#### 通过 TransformationChain 转换数据格式

1. 先定义了一个 transform_func，对前面的 parse_weather_info 函数做了一下简单的封装。它的输入，是整个 LLMChain 里，执行到 TransformChain 之前的整个输出结果的 dict。
2. 然后，我们就定义了一个 TransformChain，里面的输入参数就是 output，输出参数就是 weather_info。
3. 最后，我们通过上一讲用过的 SequentialChain，将前面的 LLMRequestsChain 和这里的 TransformChain 串联到一起，变成一个新的叫做 final_chain 的 LLMChain。
